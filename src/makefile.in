#
# @package_copyright@
#
# @configure_input@
#

.POSIX :

.SUFFIXES :
A = .@LIBEXT@
O = .@OBJEXT@
E = @EXEEXT@
.SUFFIXES : .c .i $O $A

#
# Paths for supporting headers and libraries.
#
top_srcdir 	= @top_srcdir@
abs_srcdir 	= @abs_srcdir@

prefix 		= @prefix@
exec_prefix 	= @exec_prefix@
bindir 		= @bindir@
libdir 		= @libdir@/post4

CC		= @CC@
CC_E		= @CC_E@
CC_O		= @CC_O@
CPPFLAGS	= @CPPFLAGS@
CFLAGS		= @CFLAGS@ -Wno-unused-label -funsigned-char -Wno-unused-const-variable
LDFLAGS		= @LDFLAGS@
LIBS		= @LIBS@

XARGSI		= @XARGSI@
RANLIB		= @RANLIB@
ARCHIVE		= @ARCHIVE@
COMPILE		= @COMPILE@

BUILT		:= `date +'%a, %d %b %Y %H:%M:%S %z'`

#######################################################################

#%$O : %.c
.c$O :
	$(COMPILE)

#(%) : %
#	$(ARCHIVE)$*

#%$E : %.c
.c$E :
	$(CC) $(CFLAGS) $(LDFLAGS) $(CC_E)$*$E $< $(LIBS)

#%$E : %$O
$O$E :
	$(LD) $(LDFLAGS) $(CC_E)$*$E $*$O $(LIBS)

.c.i:
	${CC} -E ${CFLAGS} $*.c >$*.i

#######################################################################

.MAIN : build

all: build

build: title post4$E

clean : title
	-rm -f *.o *.obj *.i *.map *.tds *.TR2 *.stackdump core *.core core.* *.log
	-rm -f post4$E

distclean: clean
	-rm -f config.h config.h.in makefile

realclean: distclean

title :
	@echo
	@echo '***************************************************************'
	@echo '==> '${abs_srcdir}
	@echo '***************************************************************'
	@echo

install: build
	install -p -o root -g 0 -d ${libdir}
	install -p -o root -g 0 post4.p4 ${libdir}
	install -p -o root -g 0 post4$E ${bindir}

post4$O : config.h post4.h post4.c
	${CC} ${CFLAGS} -DP4_BUILT="\"${BUILT}\"" -c post4.c

post4$E : config.h post4.h post4.c
	${CC} ${CFLAGS} ${LDFLAGS} -DTEST -DP4_BUILT="\"${BUILT}\"" -o post4$E post4.c

post4.i : config.h post4.h post4.c
	${CC} -E ${CFLAGS} -DTEST -DP4_BUILT="\"${BUILT}\"" post4.c >$*.i
